<!-- Results Section -->
<div id="results" class="mt-5">
  
  <div class="analysis-results">
    <%# Text Analysis Overview %>
    <div class="steam-section">
      <div class="steam-section-header">
        Text Analysis Overview
        <span class="analysis-score <%= @analysis.parsed_text_report['score'] == 'A' ? 'score-a' : 'score-b' %>">
          Score: <%= @analysis.parsed_text_report['score'] %>
        </span>
      </div>
      <div class="steam-section-content">
        <p>Below you'll find a detailed comparison between your current Steam page content and AI-optimized suggestions.</p>
      </div>
    </div>

    <%# Visual Analysis Section %>
    <%= render 'shared/visuals_section', visual_report: @analysis.parsed_visual_report %>

    <%# Capsule Image Analysis Section %>
    <%= render 'shared/capsule_section' %>
    
    <%# Short Description Section %>
    <div class="steam-section">
      <div class="steam-section-header">
        Short Description
      </div>
      <div class="steam-section-content">
        <div class="steam-comparison">
          <!-- Current Version -->
          <div class="steam-version">
            <div class="version-header current">
              Current Steam Page
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>Short Description</h6>
                <% if @game.short_description.present? %>
                  <p><%= sanitize @game.short_description %></p>
                <% else %>
                  <p class="text-muted">No short description provided</p>
                <% end %>
              </div>
            </div>
          </div>

          <!-- AI-Optimized Version -->
          <div class="steam-version">
            <div class="version-header optimized">
              Optimized Version
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>Short Description</h6>
                <% if @analysis.parsed_ai_suggestions.present? && @analysis.parsed_ai_suggestions['short_description'].present? %>
                  <div class="content-with-copy">
                    <div class="content">
                      <p><%= @analysis.parsed_ai_suggestions['short_description'] %></p>
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('<%= escape_javascript(@analysis.parsed_ai_suggestions['short_description']) %>')">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                <% else %>
                  <p class="text-muted">No AI suggestion available</p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%# Tags Analysis Section %>
    <%= render 'shared/tags_section', tags_list: @analysis.parsed_tags_list %>

    <%# About This Game Section %>
    <div class="steam-section">
      <div class="steam-section-header">
        About This Game
      </div>
      <div class="steam-section-content">
        <div class="steam-comparison">
          <!-- Current Version -->
          <div class="steam-version">
            <div class="version-header current">
              Current Steam Page
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>About This Game</h6>
                <% if @game.about_the_game.present? %>
                  <div><%= sanitize @game.about_the_game %></div>
                <% else %>
                  <p class="text-muted">No about section provided</p>
                <% end %>
              </div>
            </div>
          </div>

          <!-- AI-Optimized Version -->
          <div class="steam-version">
            <div class="version-header optimized">
              Optimized Version
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>About This Game</h6>
                <% if @analysis.parsed_ai_suggestions.present? && @analysis.parsed_ai_suggestions['first_paragraph'].present? %>
                  <div class="content-with-copy">
                    <div class="content">
                      <div><%= @analysis.parsed_ai_suggestions['first_paragraph'] %></div>
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('<%= escape_javascript(@analysis.parsed_ai_suggestions['first_paragraph']) %>')">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                <% else %>
                  <p class="text-muted">No AI suggestion available</p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%# Key Features Section %>
    <div class="steam-section">
      <div class="steam-section-header">
        Key Features
      </div>
      <div class="steam-section-content">
        <div class="steam-comparison">
          <!-- Current Version -->
          <div class="steam-version">
            <div class="version-header current">
              Current Steam Page
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>Key Features</h6>
                <p class="text-muted">No feature list available in current version</p>
              </div>
            </div>
          </div>

          <!-- AI-Optimized Version -->
          <div class="steam-version">
            <div class="version-header optimized">
              Optimized Version
            </div>
            <div class="version-content">
              <div class="content-block">
                <h6>Key Features</h6>
                <% if @analysis.parsed_ai_suggestions.present? && @analysis.parsed_ai_suggestions['feature_list'].present? && @analysis.parsed_ai_suggestions['feature_list'].any? %>
                  <div class="content-with-copy">
                    <div class="content">
                      <ul>
                        <% @analysis.parsed_ai_suggestions['feature_list'].each do |feature| %>
                          <li><%= feature %></li>
                        <% end %>
                      </ul>
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('<%= escape_javascript(@analysis.parsed_ai_suggestions['feature_list'].map { |f| "â€¢ #{f}" }.join("\n")) %>')">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                <% else %>
                  <p class="text-muted">No AI suggestions available</p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :styles do %>
<style>
.markdown-content {
  white-space: pre-wrap;
  font-family: inherit;
}
</style>
<% end %> 